{% extends 'users/base.html' %}
{% load static %}

{% block title %}Benchmark Settings - Flood Monitoring System{% endblock %}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <!-- Header -->
            <div class="mb-4">
                <h2 style="color: #1e40af; font-weight: 600;">
                    <i class="fas fa-sliders-h"></i> Benchmark Settings
                </h2>
                <p style="color: #666; margin-top: 0.5rem;">Configure flood risk thresholds and alert benchmarks</p>
                <hr style="border-color: #e0e7ff; margin-top: 1.5rem;">
            </div>

            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Benchmark Settings Form -->
            <form method="post" id="benchmarkForm">
                {% csrf_token %}

                <!-- Rainfall Benchmarks Section -->
                <div class="card mb-4" style="border: 1px solid #e0e7ff; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div class="card-header" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none;">
                        <h5 class="mb-0" style="color: white; font-weight: 600;">
                            <i class="fas fa-cloud-rain"></i> Rainfall Benchmarks (mm)
                        </h5>
                    </div>
                    <div class="card-body">
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1.5rem;">
                            Define rainfall thresholds for risk assessment. Moderate threshold must be lower than High threshold.
                        </p>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="rainfall_moderate" class="form-label" style="font-weight: 600; color: #374151;">
                                    Moderate Risk Threshold <span style="color: #ef4444;">*</span>
                                </label>
                                <div class="input-group">
                                    <input 
                                        type="number" 
                                        class="form-control" 
                                        id="rainfall_moderate"
                                        name="rainfall_moderate_threshold" 
                                        value="{{ settings.rainfall_moderate_threshold }}"
                                        step="0.5"
                                        min="0"
                                        required
                                        style="border-color: #e5e7eb;"
                                    >
                                    <span class="input-group-text" style="border-color: #e5e7eb; background-color: #f9fafb;">mm</span>
                                </div>
                                <small style="color: #999; display: block; margin-top: 0.5rem;">
                                    Triggers <span style="color: #f97316; font-weight: 600;">ORANGE (Moderate)</span> risk
                                </small>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="rainfall_high" class="form-label" style="font-weight: 600; color: #374151;">
                                    High Risk Threshold <span style="color: #ef4444;">*</span>
                                </label>
                                <div class="input-group">
                                    <input 
                                        type="number" 
                                        class="form-control" 
                                        id="rainfall_high"
                                        name="rainfall_high_threshold" 
                                        value="{{ settings.rainfall_high_threshold }}"
                                        step="0.5"
                                        min="0"
                                        required
                                        style="border-color: #e5e7eb;"
                                    >
                                    <span class="input-group-text" style="border-color: #e5e7eb; background-color: #f9fafb;">mm</span>
                                </div>
                                <small style="color: #999; display: block; margin-top: 0.5rem;">
                                    Triggers <span style="color: #ef4444; font-weight: 600;">RED (High)</span> risk
                                </small>
                            </div>
                        </div>

                        <div class="alert alert-info" style="background-color: #dbeafe; border-color: #93c5fd; color: #1e40af; margin-top: 1rem;">
                            <small>
                                <i class="fas fa-info-circle"></i> 
                                Currently: <strong>&lt; {{ settings.rainfall_moderate_threshold }}mm</strong> = Yellow (Low),
                                <strong>{{ settings.rainfall_moderate_threshold }}-{{ settings.rainfall_high_threshold }}mm</strong> = Orange (Moderate),
                                <strong>≥ {{ settings.rainfall_high_threshold }}mm</strong> = Red (High)
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Tide Level Benchmarks Section -->
                <div class="card mb-4" style="border: 1px solid #e0e7ff; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div class="card-header" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); border: none;">
                        <h5 class="mb-0" style="color: white; font-weight: 600;">
                            <i class="fas fa-water"></i> Tide Level Benchmarks (meters)
                        </h5>
                    </div>
                    <div class="card-body">
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1.5rem;">
                            Define tide level thresholds for risk assessment. Moderate threshold must be lower than High threshold.
                        </p>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="tide_moderate" class="form-label" style="font-weight: 600; color: #374151;">
                                    Moderate Risk Threshold <span style="color: #ef4444;">*</span>
                                </label>
                                <div class="input-group">
                                    <input 
                                        type="number" 
                                        class="form-control" 
                                        id="tide_moderate"
                                        name="tide_moderate_threshold" 
                                        value="{{ settings.tide_moderate_threshold }}"
                                        step="0.1"
                                        min="0"
                                        required
                                        style="border-color: #e5e7eb;"
                                    >
                                    <span class="input-group-text" style="border-color: #e5e7eb; background-color: #f9fafb;">m</span>
                                </div>
                                <small style="color: #999; display: block; margin-top: 0.5rem;">
                                    Triggers <span style="color: #f97316; font-weight: 600;">ORANGE (Moderate)</span> risk
                                </small>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="tide_high" class="form-label" style="font-weight: 600; color: #374151;">
                                    High Risk Threshold <span style="color: #ef4444;">*</span>
                                </label>
                                <div class="input-group">
                                    <input 
                                        type="number" 
                                        class="form-control" 
                                        id="tide_high"
                                        name="tide_high_threshold" 
                                        value="{{ settings.tide_high_threshold }}"
                                        step="0.1"
                                        min="0"
                                        required
                                        style="border-color: #e5e7eb;"
                                    >
                                    <span class="input-group-text" style="border-color: #e5e7eb; background-color: #f9fafb;">m</span>
                                </div>
                                <small style="color: #999; display: block; margin-top: 0.5rem;">
                                    Triggers <span style="color: #ef4444; font-weight: 600;">RED (High)</span> risk
                                </small>
                            </div>
                        </div>

                        <div class="alert alert-info" style="background-color: #cffafe; border-color: #a5f3fc; color: #0c7792; margin-top: 1rem;">
                            <small>
                                <i class="fas fa-info-circle"></i> 
                                Currently: <strong>&lt; {{ settings.tide_moderate_threshold }}m</strong> = Yellow (Low),
                                <strong>{{ settings.tide_moderate_threshold }}-{{ settings.tide_high_threshold }}m</strong> = Orange (Moderate),
                                <strong>≥ {{ settings.tide_high_threshold }}m</strong> = Red (High)
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Combined Risk Logic Explanation -->
                <div class="card mb-4" style="border: 1px solid #e0e7ff; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div class="card-header" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border: none;">
                        <h5 class="mb-0" style="color: white; font-weight: 600;">
                            <i class="fas fa-chart-pie"></i> Alert Logic
                        </h5>
                    </div>
                    <div class="card-body">
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1.5rem;">
                            The alert level is determined by checking if <strong>BOTH</strong> rainfall AND tide level meet their thresholds simultaneously.
                        </p>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="alert" style="background-color: #fef3c7; border-color: #fcd34d; color: #92400e; margin-bottom: 0;">
                                    <strong style="font-size: 1rem;"><i class="fas fa-circle" style="color: #fcd34d;"></i> Low Risk (Yellow)</strong>
                                    <p style="margin-top: 0.5rem; margin-bottom: 0; font-size: 0.85rem;">
                                        Rainfall &lt; {{ settings.rainfall_moderate_threshold }}mm<br>
                                        <strong>OR</strong><br>
                                        Tide &lt; {{ settings.tide_moderate_threshold }}m<br>
                                        <small style="display: block; margin-top: 0.5rem; color: #666;">Both thresholds not met</small>
                                    </p>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="alert" style="background-color: #fed7aa; border-color: #fdba74; color: #9a3412; margin-bottom: 0;">
                                    <strong style="font-size: 1rem;"><i class="fas fa-circle" style="color: #fdba74;"></i> Moderate Risk (Orange)</strong>
                                    <p style="margin-top: 0.5rem; margin-bottom: 0; font-size: 0.85rem;">
                                        Rainfall ≥ {{ settings.rainfall_moderate_threshold }}mm<br>
                                        <strong>AND</strong><br>
                                        Tide ≥ {{ settings.tide_moderate_threshold }}m<br>
                                        <small style="display: block; margin-top: 0.5rem; color: #666;">Both moderate thresholds met</small>
                                    </p>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="alert" style="background-color: #fecaca; border-color: #fca5a5; color: #7f1d1d; margin-bottom: 0;">
                                    <strong style="font-size: 1rem;"><i class="fas fa-circle" style="color: #fca5a5;"></i> High Risk (Red)</strong>
                                    <p style="margin-top: 0.5rem; margin-bottom: 0; font-size: 0.85rem;">
                                        Rainfall ≥ {{ settings.rainfall_high_threshold }}mm<br>
                                        <strong>AND</strong><br>
                                        Tide ≥ {{ settings.tide_high_threshold }}m<br>
                                        <small style="display: block; margin-top: 0.5rem; color: #666;">Both high thresholds met</small>
                                    </p>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="alert" style="background-color: #e0e7ff; border-color: #c7d2fe; color: #3730a3; margin-bottom: 0;">
                                    <strong style="font-size: 1rem;"><i class="fas fa-lightbulb"></i> Example</strong>
                                    <p style="margin-top: 0.5rem; margin-bottom: 0; font-size: 0.85rem;">
                                        Rainfall: 32mm (≥30)<br>
                                        Tide: 0.3m (&lt;1.0)<br>
                                        <strong style="color: #1f2937;">Result: Low Risk</strong>
                                        <small style="display: block; margin-top: 0.3rem;">Because tide didn't meet its threshold</small>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info" style="background-color: #f3e8ff; border-color: #ddd6fe; color: #6b21a8; margin-top: 1rem;">
                            <small>
                                <i class="fas fa-info-circle"></i> 
                                <strong>Key Point:</strong> Both rainfall AND tide must meet the threshold at the same time to trigger that risk level. If only one meets the threshold, the alert remains at a lower level.
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="d-flex gap-2" style="margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary flex-grow-1" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; font-weight: 600;">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <a href="{% url 'monitoring_view' %}" class="btn btn-secondary flex-grow-1" style="background-color: #6b7280; border: none; font-weight: 600;">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>

                <!-- Info Box -->
                <div class="alert alert-light" style="border-left: 4px solid #3b82f6; margin-top: 2rem;">
                    <small style="color: #666;">
                        <strong><i class="fas fa-info-circle"></i> Note:</strong> Changes to these benchmarks will take effect immediately and apply to all future risk calculations across the monitoring dashboard. Alerts are automatically generated based on the rainfall and tide level risk levels.
                    </small>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .card {
        border-radius: 8px;
        overflow: hidden;
    }

    .card-header {
        padding: 1rem;
    }

    .form-control, .input-group-text {
        border-radius: 4px;
    }

    .form-control:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .btn {
        border-radius: 4px;
        padding: 0.6rem 1.5rem;
        font-size: 0.95rem;
        transition: all 0.3s ease;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .alert {
        border-radius: 4px;
        border-left: 4px solid;
    }

    @media (max-width: 768px) {
        .col-md-6 {
            margin-bottom: 1.5rem;
        }
    }
</style>

{% endblock %}
